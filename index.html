<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guitar Hand Simulator</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- TOP MONITOR CONTAINER -->
    <div id="top-monitor-container">
        <div id="chord-monitor">C</div>
        
        <!-- Moved Chord Diagram -->
        <div id="chord-diagram" class="glass-panel">
            <div id="finger-list"></div> 
            <div class="string-diagram">
                <div id="fretboard-text"></div>
            </div>
        </div>
    </div>

    <!-- SIDEBAR CONTAINER -->
    <div id="sidebar-container" style="position: absolute; top: 24px; left: 24px; display: flex; flex-direction: column; gap: 12px; width: 340px; pointer-events: none; z-index: 10;">
        
        <!-- ACTION BAR -->
        <div id="action-bar" class="glass-panel" style="pointer-events: auto; padding: 10px;">
            <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                <!-- Panel Toggles -->
                <button class="icon-btn" onclick="uiManager.toggleChordPanel()" id="toggle-chord-panel-btn" title="Toggle Chords" style="color: var(--primary); background: rgba(59, 130, 246, 0.1);">üé∏</button>
                <button class="icon-btn" onclick="uiManager.toggleAdjustmentPanel()" id="toggle-adjust-panel-btn" title="Toggle Settings">üõ†</button>
                
                <div style="width: 1px; height: 20px; background: var(--panel-border); margin: 0 2px;"></div>
                
                <!-- Existing Controls -->
                <button class="btn-xs" onclick="uiManager.toggleBeginnerMode()" id="beginner-btn" data-i18n="beginner" style="opacity: 0.5;">üéì Beginner</button>
                <button class="btn-xs" onclick="uiManager.toggleHandVisibility()" id="hand-toggle-btn" title="Toggle Hand">üñêÔ∏è</button>
                <button class="btn-xs" onclick="uiManager.toggleOrientation()" id="orient-btn" title="Rotate View" style="opacity: 0.5;">üîÑ</button>
                <button class="btn-xs" onclick="uiManager.toggleMute()" id="mute-btn" title="Toggle Sound">üîä</button>
                
                <div style="width: 1px; height: 20px; background: var(--panel-border); margin: 0 2px;"></div>

                <button class="btn-xs" onclick="TranslationManager.setLang('en')" id="lang-en" style="opacity: 0.5;">EN</button>
                <button class="btn-xs" onclick="TranslationManager.setLang('es')" id="lang-es" style="opacity: 1;">ES</button>
            </div>
        </div>

        <!-- CHORD PANEL -->
        <div id="chord-panel" class="glass-panel" style="pointer-events: auto; max-height: 50vh; display: flex; flex-direction: column;">
            <div style="padding: 12px 16px; border-bottom: 1px solid var(--panel-border); background: rgba(255,255,255,0.02); display: flex; justify-content: space-between; align-items: center;">
                 <h3 data-i18n="title" style="margin: 0; font-size: 14px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">üé∏ Hand Simulator</h3>
            </div>
            
            <!-- Hierarchical Selector -->
            <div id="selector-container" style="padding: 12px 12px 0 12px; border-bottom: 1px solid var(--panel-border);">
                <div id="root-selector" class="scroll-row"></div>
                <div id="type-selector" class="scroll-row"></div>
                <div id="category-selector" class="scroll-row" style="margin-bottom: 0px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 8px;"></div>
                <div id="bass-selector" class="scroll-row" style="margin-bottom: 0px; display: none;"></div>
                <div id="inversion-selector" class="scroll-row" style="margin-bottom: 8px; display: none;"></div>
            </div>
            
            <!-- Variation Selector -->
            <div id="variation-selector" class="variation-list" style="padding: 8px 12px; flex-grow: 1; overflow-y: auto;"></div>
        </div>

        <!-- ADJUSTMENT PANEL -->
        <div id="adjustment-panel" class="glass-panel" style="pointer-events: auto; max-height: 40vh; overflow-y: auto; display: none;">
            <div style="padding: 12px 16px; border-bottom: 1px solid var(--panel-border); background: rgba(255,255,255,0.02);">
                <h3 data-i18n="hand_adj" style="margin: 0; font-size: 14px; font-weight: 600; text-transform: uppercase; color: var(--text-muted);">üõ† Hand Adjustment</h3>
            </div>

            <div id="panel-content">
                <!-- Hand Transformation Controls -->
                <div id="debug-controls">
                    <h4 style="margin: 8px 0; font-size: 12px; color: var(--text-muted);">Position</h4>
                    <div class="control-row">
                        <label>Pos X</label>
                        <input type="range" min="-2" max="2" step="0.05" value="0" id="hand-pos-x" oninput="uiManager.updateHandPosition('x', this.value)">
                        <span id="hand-pos-x-val">0.0</span>
                    </div>
                    <div class="control-row">
                        <label>Pos Y</label>
                        <input type="range" min="-2" max="2" step="0.05" value="0" id="hand-pos-y" oninput="uiManager.updateHandPosition('y', this.value)">
                        <span id="hand-pos-y-val">0.0</span>
                    </div>
                    <div class="control-row">
                        <label>Pos Z</label>
                        <input type="range" min="-2" max="2" step="0.05" value="0" id="hand-pos-z" oninput="uiManager.updateHandPosition('z', this.value)">
                        <span id="hand-pos-z-val">0.0</span>
                    </div>

                    <h4 style="margin: 16px 0 8px 0; font-size: 12px; color: var(--text-muted);">Rotation (radians)</h4>
                    <div class="control-row">
                        <label>Rot X</label>
                        <input type="range" min="-3.14" max="3.14" step="0.1" value="0" id="hand-rot-x" oninput="uiManager.updateHandRotation('x', this.value)">
                        <span id="hand-rot-x-val">0.0</span>
                    </div>
                    <div class="control-row">
                        <label>Rot Y</label>
                        <input type="range" min="-3.14" max="3.14" step="0.1" value="0" id="hand-rot-y" oninput="uiManager.updateHandRotation('y', this.value)">
                        <span id="hand-rot-y-val">0.0</span>
                    </div>
                    <div class="control-row">
                        <label>Rot Z</label>
                        <input type="range" min="-3.14" max="3.14" step="0.1" value="0" id="hand-rot-z" oninput="uiManager.updateHandRotation('z', this.value)">
                        <span id="hand-rot-z-val">0.0</span>
                    </div>

                    <div style="margin-top: 16px; display: grid; grid-template-columns: 1fr auto; gap: 8px;">
                        <button onclick="uiManager.resetHandTransform()" class="btn btn-secondary icon-btn" title="Reset">‚Ü∫</button>
                        <button onclick="uiManager.logHandTransform()" class="btn btn-secondary" style="font-size: 11px;">Log Values</button>
                    </div>

                    <div id="panel-cam-coords" style="margin-top: 12px; font-size: 11px; color: var(--text-muted); text-align: right; border-top: 1px solid var(--panel-border); padding-top: 8px; font-family: monospace;">Cam: 0, 0, 0</div>
                </div>
            </div>
        </div>

    </div>

    <!-- INFO OVERLAY -->
    <div id="info">
        Drag to rotate | Scroll to zoom | Current: <span id="current-chord-display">C</span>
        <div id="camera-info" style="font-size: 0.8em; opacity: 0.7; margin-top: 5px; font-family: monospace;"></div>
    </div>

    <!-- MODAL -->
    <div id="chordModal" class="modal">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h2 data-i18n="manage_lib">Manage Library</h2>
                <button class="icon-btn" onclick="closeModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="reset-bar">
                    <button class="btn btn-secondary btn-full" onclick="libraryManager.resetLibrary()">
                         <span data-i18n="reset_lib">Reset Library to Defaults</span>
                    </button>
                    <p data-i18n="reloads" style="text-align: center; font-size: 11px; opacity: 0.5; margin-top: 8px;">
                        (Reloads from js/chords/ folders)
                    </p>
                </div>

                <div class="divider"></div>

                <h3 data-i18n="chord_editor">Chord Editor</h3>
                <div class="form-group">
                    <label data-i18n="chord_name">Chord Name</label>
                    <input type="text" id="edit-name" placeholder="e.g. Bm7">
                </div>

                <div id="string-inputs">
                    <!-- Generated by JS -->
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" id="delete-chord-btn" onclick="deleteChord()" style="display:none; color: #ff6b6b;">Delete</button>
                <div style="flex-grow: 1;"></div>
                <button class="btn btn-primary" onclick="saveChordFromForm()"><span data-i18n="save_changes">Save Changes</span></button>
            </div>
        </div>
    </div>

    <!-- THREE.JS IMPORT MAP -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- APP SCRIPT -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
