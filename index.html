<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Guitar Hand Simulator</title>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Custom CSS -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <!-- CONTROL PANEL -->
    <div id="controls" class="glass-panel">
        
        <div class="panel-header">
            <h3 data-i18n="title">üé∏ Hand Simulator</h3>
            <div style="display: flex; gap: 4px; margin-right: 8px;">
                <button class="btn-xs" onclick="TranslationManager.setLang('en')" id="lang-en" style="opacity: 0.5;">EN</button>
                <button class="btn-xs" onclick="TranslationManager.setLang('es')" id="lang-es" style="opacity: 1;">ES</button>
                <button class="btn-xs" onclick="uiManager.toggleBeginnerMode()" id="beginner-btn" style="opacity: 0.5; margin-left: 4px;" data-i18n="beginner">üéì Beginner</button>
                <button class="btn-xs" onclick="uiManager.toggleHandVisibility()" id="hand-toggle-btn" style="opacity: 1; margin-left: 4px;" title="Toggle Hand">üñêÔ∏è</button>
            </div>
            <button id="toggle-btn" onclick="togglePanel()" class="icon-btn" title="Toggle Panel">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line></svg>
            </button>
        </div>

        <!-- Hierarchical Selector -->
        <div id="selector-container" style="padding: 12px 12px 0 12px; border-bottom: 1px solid var(--panel-border);">
            <div id="root-selector" class="scroll-row"></div>
            <div id="type-selector" class="scroll-row"></div>
            <div id="category-selector" class="scroll-row" style="margin-bottom: 0px; border-top: 1px solid rgba(255,255,255,0.05); padding-top: 8px;"></div>
            <div id="inversion-selector" class="scroll-row" style="margin-bottom: 8px; display: none;"></div>
        </div>
        
        <div id="panel-content">
            
            <div id="variation-selector" class="variation-list" style="margin-bottom: 16px;"></div>

            <!-- Active Chord Info -->
            <div id="chord-diagram">
                <h4 data-i18n="finger_pos">üìç Finger Positions</h4>
                <div id="finger-list"></div>
                <div class="string-diagram">
                    <div id="fretboard-text"></div>
                </div>
            </div>

            <!-- Hand Transformation Controls -->
            <div id="debug-controls">
                <h4 style="margin: 0 0 16px 0; color: var(--text-main); font-size: 13px;" data-i18n="hand_adj">üõ† Hand Adjustment</h4>
                
                <div class="control-row">
                    <label>X</label>
                    <input type="range" min="-1" max="1" step="0.1" value="0" oninput="uiManager.updateHandOffset('x', this.value)">
                    <span id="offset-x">0.0</span>
                </div>
                <div class="control-row">
                    <label>Y</label>
                    <input type="range" min="-1" max="1" step="0.1" value="0" oninput="uiManager.updateHandOffset('y', this.value)">
                    <span id="offset-y">0.0</span>
                </div>
                
                <div style="margin-top: 16px; display: grid; grid-template-columns: 1fr auto; gap: 8px;">
                    <button onclick="uiManager.resetCurrentOffset()" class="btn btn-secondary icon-btn" title="Reset">‚Ü∫</button>
                </div>
            </div>
        </div>
    </div>

    <!-- INFO OVERLAY -->
    <div id="info">
        Drag to rotate | Scroll to zoom | Current: <span id="current-chord-display">C</span>
        <div id="camera-info" style="font-size: 0.8em; opacity: 0.7; margin-top: 5px; font-family: monospace;"></div>
    </div>

    <!-- MODAL -->
    <div id="chordModal" class="modal">
        <div class="modal-content glass-panel">
            <div class="modal-header">
                <h2 data-i18n="manage_lib">Manage Library</h2>
                <button class="icon-btn" onclick="closeModal()">
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            
            <div class="modal-body">
                <div class="reset-bar">
                    <button class="btn btn-secondary btn-full" onclick="libraryManager.resetLibrary()">
                         <span data-i18n="reset_lib">Reset Library to Defaults</span>
                    </button>
                    <p data-i18n="reloads" style="text-align: center; font-size: 11px; opacity: 0.5; margin-top: 8px;">
                        (Reloads from js/chords/ folders)
                    </p>
                </div>

                <div class="divider"></div>

                <h3 data-i18n="chord_editor">Chord Editor</h3>
                <div class="form-group">
                    <label data-i18n="chord_name">Chord Name</label>
                    <input type="text" id="edit-name" placeholder="e.g. Bm7">
                </div>

                <div id="string-inputs">
                    <!-- Generated by JS -->
                </div>
            </div>

            <div class="modal-footer">
                <button class="btn btn-secondary" id="delete-chord-btn" onclick="deleteChord()" style="display:none; color: #ff6b6b;">Delete</button>
                <div style="flex-grow: 1;"></div>
                <button class="btn btn-primary" onclick="saveChordFromForm()"><span data-i18n="save_changes">Save Changes</span></button>
            </div>
        </div>
    </div>

    <!-- THREE.JS IMPORT MAP -->
    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
        }
    }
    </script>

    <!-- APP SCRIPT -->
    <script type="module" src="js/app.js"></script>
</body>
</html>
